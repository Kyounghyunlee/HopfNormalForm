module Systems

using SymEngine
using ..HopfNormalForm: calculate_normal_form

const I=1im

function example1()
    norder = 3; # Choose the order of power series representation of Centermanifold
    cm = 3; # Dimension of Centermanifold of the dynamical system
    m1 = 1; # Number of the zero eigenvalue corresponding to the center space of the Jacobian
    m2 = 1; # Number of pair of complex conjugate eigenvalue corresponding to the center space of the Jacobian
    m3 = 4; # Dimension of the stable manifold of the dynmical system
    n = m1+2*m2+m3; # Total dimension of the dynamical system
    ω_h = 15.2956; # Eigenvalue that crosses unit circle at Hopf bifurcation point ± ω_h
    zero_tol = 1e-10; # zero tolerance to chop out very small coeffs of symbolic computation

    v = [symbols("v_$i") for i in 1:n]; # Define state-space variables
    f = Array{Basic}(undef, n);

    @vars ka2, ka3  # Define symbolic variables which is needed to define the equation of motion
    # In this example the variables are nonlinear stifness parameters

    # Define the equation of motion at the Hopf bifurcation point where the dimension of centermanifold is 2
    # Let the dimension of control parameter vector be 1, and express it as a one of state-space variable v[1]
    # d/dt v[1]=0 and let rest of the state-space variable be v[2],v[3],…,v[n].

    f[1] = 0;

    f[2] = 15.2956*v[2]*I-1.0*v[3]*(0.4e-4*v[1]^3*I+v[1]^2*(0.32e-2+0.271e-2*I)+v[1]*(.12516+0.5629e-1*I))+v[7]*(v[1]^3*(0.28e-3-0.6e-3*I)+v[1]^2*(0.1194e-1-0.1605e-1*I)+v[1]*(.14835-.17292*I))+v[6]*(-v[1]^3*(0.4e-4-0.9e-4*I)+v[1]^2*(0.128e-2-0.416e-2*I)+v[1]*(0.9561e-1-0.6305e-1*I))+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))+v[4]*(v[1]^3*(0.1e-4-0.5e-4*I)+v[1]^2*(0.452e-2-0.99e-3*I)+v[1]*(.14142+0.1445e-1*I))+v[2]*(v[1]^3*(0.3e-4-0.3e-4*I)+v[1]^2*(0.443e-2+0.111e-2*I)+v[1]*(.11511+0.57e-1*I))-1.0*v[5]*(-v[1]^3*(0.3e-4-0.4e-4*I)+v[1]^2*(0.167e-2+0.37e-2*I)+v[1]*(0.9759e-1+0.9922e-1*I));

    f[3] = -15.2956*v[3]*I-1.0*v[2]*(-0.4e-4*v[1]^3*I+v[1]^2*(0.32e-2-0.271e-2*I)+v[1]*(.12516-0.5629e-1*I))+v[7]*(v[1]^3*(0.28e-3+0.6e-3*I)+v[1]^2*(0.1194e-1+0.1605e-1*I)+v[1]*(.14835+.17292*I))+v[6]*(-v[1]^3*(0.4e-4+0.9e-4*I)+v[1]^2*(0.128e-2+0.416e-2*I)+v[1]*(0.9561e-1+0.6305e-1*I))+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))+v[5]*(v[1]^3*(0.1e-4+0.5e-4*I)+v[1]^2*(0.452e-2+0.99e-3*I)+v[1]*(.14142-0.1445e-1*I))+v[3]*(v[1]^3*(0.3e-4+0.3e-4*I)+v[1]^2*(0.443e-2-0.111e-2*I)+v[1]*(.11511-0.57e-1*I))-1.0*v[4]*(-v[1]^3*(0.3e-4+0.4e-4*I)+v[1]^2*(0.167e-2-0.37e-2*I)+v[1]*(0.9759e-1-0.9922e-1*I));

    f[4] = -v[4]*(3.62964-16.5475*I)+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*v[7]*(v[1]^3*(0.6e-3-0.52e-3*I)+v[1]^2*(0.2143e-1-0.111e-1*I)+v[1]*(.255-.10714*I))-1.0*v[2]*(v[1]^3*(0.5e-4-0.1e-4*I)+v[1]^2*(0.431e-2+0.342e-2*I)+v[1]*(.12562+.12667*I))-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))+v[3]*(-v[1]^3*(0.2e-4-0.4e-4*I)+v[1]^2*(0.213e-2+0.45e-2*I)+v[1]*(0.8159e-1+.11428*I))-1.0*v[6]*(-v[1]^3*(0.9e-4-0.8e-4*I)+v[1]^2*(0.335e-2-0.402e-2*I)+v[1]*(.14493-0.1258e-1*I))-1.0*v[5]*(v[1]^3*(0.6e-4-0.2e-4*I)+v[1]^2*(0.1e-4-0.479e-2*I)-v[1]*(0.2819e-1+.14641*I))-1.0*v[4]*(v[1]^3*(0.3e-4-0.5e-4*I)+v[1]^2*(0.548e-2+0.116e-2*I)+v[1]*(.17731+0.9448e-1*I));

    f[5] = -v[5]*(3.62964+16.5475*I)+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*v[7]*(v[1]^3*(0.6e-3+0.52e-3*I)+v[1]^2*(0.2143e-1+0.111e-1*I)+v[1]*(.255+.10714*I))-1.0*v[3]*(v[1]^3*(0.5e-4+0.1e-4*I)+v[1]^2*(0.431e-2-0.342e-2*I)+v[1]*(.12562-.12667*I))-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))+v[2]*(-v[1]^3*(0.2e-4+0.4e-4*I)+v[1]^2*(0.213e-2-0.45e-2*I)+v[1]*(0.8159e-1-.11428*I))-1.0*v[6]*(-v[1]^3*(0.9e-4+0.8e-4*I)+v[1]^2*(0.335e-2+0.402e-2*I)+v[1]*(.14493+0.1258e-1*I))-1.0*v[4]*(v[1]^3*(0.6e-4+0.2e-4*I)+v[1]^2*(0.1e-4+0.479e-2*I)-v[1]*(0.2819e-1-.14641*I))-1.0*v[5]*(v[1]^3*(0.3e-4+0.5e-4*I)+v[1]^2*(0.548e-2-0.116e-2*I)+v[1]*(.17731-0.9448e-1*I));

    f[6] = -40.8273*v[6]-1.0*v[7]*(-0.14e-3*v[1]^3+.14775*v[1]^2+2.27406*v[1])+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))-1.0*v[6]*(0.2e-4*v[1]^3-0.243e-1*v[1]^2+2.27519*v[1])-1.0*v[4]*(-0.1e-4*v[1]^3+v[1]^2*(0.107e-1-0.421e-2*I)+v[1]*(.33455-0.656e-2*I))-1.0*v[5]*(-0.1e-4*v[1]^3+v[1]^2*(0.107e-1+0.421e-2*I)+v[1]*(.33455+0.656e-2*I))-1.0*v[2]*(-0.1e-4*v[1]^3+v[1]^2*(0.803e-2+0.301e-2*I)+v[1]*(0.9551e-1-0.2376e-1*I))-1.0*v[3]*(-0.1e-4*v[1]^3+v[1]^2*(0.803e-2-0.301e-2*I)+v[1]*(0.9551e-1+0.2376e-1*I));

    f[7] = -6.21943*v[7]+ka3*(v[2]^3*(0.3e-4-0.1e-4*I)-v[2]^2*v[3]*(0.9e-4-0.4e-4*I)+v[2]^2*v[4]*(0.7e-4-0.6e-4*I)-v[2]^2*v[5]*(0.9e-4-0.2e-4*I)+v[2]*v[3]^2*(0.9e-4-0.4e-4*I)-v[2]*v[3]*v[4]*(0.14e-3-0.12e-3*I)+v[2]*v[3]*v[5]*(0.18e-3-0.5e-4*I)+v[2]*v[4]^2*(0.5e-4-0.7e-4*I)-v[2]*v[4]*v[5]*(0.16e-3-0.8e-4*I)+0.9e-4*v[2]*v[5]^2-v[3]^3*(0.3e-4-0.1e-4*I)+v[3]^2*v[4]*(0.7e-4-0.6e-4*I)-v[3]^2*v[5]*(0.9e-4-0.2e-4*I)-v[3]*v[4]^2*(0.5e-4-0.7e-4*I)+v[3]*v[4]*v[5]*(0.16e-3-0.8e-4*I)-0.9e-4*v[3]*v[5]^2+v[4]^3*(0.1e-4-0.3e-4*I)-v[4]^2*v[5]*(0.6e-4-0.5e-4*I)+v[4]*v[5]^2*(0.8e-4-0.2e-4*I)-0.3e-4*v[5]^3)-1.0*ka2*(0.1e-4*v[2]*v[7]+v[2]*v[4]*(0.65e-3+0.79e-3*I)-v[2]*v[5]*(0.26e-3+0.99e-3*I)-v[3]*v[4]*(0.65e-3+0.79e-3*I)+v[2]*v[6]*(0.2e-4-0.1e-4*I)+v[3]*v[5]*(0.26e-3+0.99e-3*I)-v[2]*v[3]*(0.49e-3+0.97e-3*I)-v[3]*v[6]*(0.2e-4-0.1e-4*I)-v[4]*v[5]*(0.44e-3+0.87e-3*I)-0.1e-4*v[3]*v[7]+v[4]*v[6]*(0.1e-4-0.1e-4*I)+v[4]*v[7]*(0.1e-4-0.1e-4*I)-0.2e-4*v[5]*v[6]-0.1e-4*v[5]*v[7]+v[2]^2*(0.25e-3+0.48e-3*I)+v[3]^2*(0.25e-3+0.48e-3*I)+v[4]^2*(0.38e-3+0.3e-3*I)+v[5]^2*(0.2e-4+0.49e-3*I))-1.0*v[7]*(-0.3e-4*v[1]^3+0.2221e-1*v[1]^2+.34233*v[1])-1.0*v[2]*(v[1]^2*(0.121e-2+0.43e-3*I)+v[1]*(0.1059e-1-0.445e-2*I))-1.0*v[3]*(v[1]^2*(0.121e-2-0.43e-3*I)+v[1]*(0.1059e-1+0.445e-2*I))-1.0*v[4]*(v[1]^2*(0.16e-2-0.66e-3*I)+v[1]*(0.4621e-1-0.184e-2*I))-1.0*v[5]*(v[1]^2*(0.16e-2+0.66e-3*I)+v[1]*(0.4621e-1+0.184e-2*I))-1.0*v[6]*(-0.37e-2*v[1]^2+.34312*v[1]);

    f[2] = f[2]/ω_h; f[3] = f[3]/ω_h; f[4] = f[4]/ω_h; f[5] = f[5]/ω_h; f[6] = f[6]/ω_h; f[7] = f[7]/ω_h;

    return calculate_normal_form(f, v, norder, cm, m1, m2, m3, n, ω_h, zero_tol)
end

end # module
