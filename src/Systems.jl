module Systems

using SymEngine
using ..HopfNormalForm: calculate_normal_form
const I=1im
const i=1im

function example1()
    norder = 3; # Choose the order of power series representation of Centermanifold
    cm = 3; # Dimension of Centermanifold of the dynamical system
    m1 = 1; # Number of the zero eigenvalue corresponding to the center space of the Jacobian
    m2 = 1; # Number of pair of complex conjugate eigenvalue corresponding to the center space of the Jacobian
    m3 = 4; # Dimension of the stable manifold of the dynmical system
    n = m1+2*m2+m3; # Total dimension of the dynamical system
    ω_h = 15.4793; # Eigenvalue that crosses unit circle at Hopf bifurcation point ± ω_h
    zero_tol = 1e-11; # zero tolerance to chop out very small coeffs of symbolic computation

    v = [symbols("v_$i") for i in 1:n]; # Define state-space variables
    f = Array{Basic}(undef, n);

    @vars ka2, ka3, ν  # Define symbolic variables which is needed to define the equation of motion
    # In this example the variables are nonlinear stifness parameters

    # Define the equation of motion at the Hopf bifurcation point where the dimension of centermanifold is 2
    # Let the dimension of control parameter vector be 1, and express it as a one of state-space variable v[1]
    # d/dt v[1]=0 and let rest of the state-space variable be v[2],v[3],…,v[n].
    f[1]=0

    f[2]=v[2]*15.4793i + ka2*(- v[2]*v[3]*(0.00329 + 0.00786i) + v[2]*v[4]*(0.00457 + 0.00683i) - v[2]*v[5]*(0.00165 + 0.00805i) - v[3]*v[4]*(0.00457 + 0.00683i) - v[2]*v[6]*(0.00018 - 0.00007i) + v[3]*v[5]*(0.00165 + 0.00805i) - v[2]*v[7]*(0.00006 - 0.00002i) + v[3]*v[6]*(0.00018 - 0.00007i) - v[4]*v[5]*(0.00306 + 0.00731i) + v[3]*v[7]*(0.00006 - 0.00002i) - v[4]*v[6]*(0.00015 - 0.0001i) - v[4]*v[7]*(0.00005 - 0.00003i) + v[5]*v[6]*(0.00018 - 0.00004i) + v[5]*v[7]*(0.00006 - 0.00001i) + v[2]^2*(0.00164 + 0.00393i) + v[3]^2*(0.00164 + 0.00393i) + v[4]^2*(0.00279 + 0.00281i) + v[5]^2*(0.00004 + 0.00396i)) + ka3*(v[2]*v[3]^2*(0.0007 - 0.00029i) - v[2]^2*v[3]*(0.0007 - 0.00029i) + v[2]*v[4]^2*(0.0005 - 0.0005i) + v[2]^2*v[4]*(0.00061 - 0.00041i) + v[2]*v[5]^2*(0.00071 - 0.00001i) - v[3]*v[4]^2*(0.0005 - 0.0005i) - v[2]^2*v[5]*(0.00072 - 0.00015i) + v[3]^2*v[4]*(0.00061 - 0.00041i) - v[3]*v[5]^2*(0.00071 - 0.00001i) + v[2]^2*v[6]*(0.00001 + 0.00002i) - v[3]^2*v[5]*(0.00072 - 0.00015i) + v[4]*v[5]^2*(0.00067 - 0.00014i) + v[3]^2*v[6]*(0.00001 + 0.00002i) - v[4]^2*v[5]*(0.00057 - 0.00038i) + v[4]^2*v[6]*(0.00001 + 0.00001i) + v[5]^2*v[6]*0.00002i + v[2]^3*(0.00023 - 0.0001i) - v[3]^3*(0.00023 - 0.0001i) + v[4]^3*(0.00013 - 0.00019i) - v[5]^3*(0.00022 + 0.00004i) - v[2]*v[3]*v[4]*(0.00122 - 0.00082i) + v[2]*v[3]*v[5]*(0.00144 - 0.0003i) - v[2]*v[3]*v[6]*(0.00001 + 0.00003i) - v[2]*v[4]*v[5]*(0.00131 - 0.00055i) - v[2]*v[3]*v[7]*0.00001i + v[2]*v[4]*v[6]*(0.00002 + 0.00003i) + v[3]*v[4]*v[5]*(0.00131 - 0.00055i) + v[2]*v[4]*v[7]*(0.00001 + 0.00001i) - v[2]*v[5]*v[6]*(0.00001 + 0.00003i) - v[3]*v[4]*v[6]*(0.00002 + 0.00003i) - v[2]*v[5]*v[7]*0.00001i - v[3]*v[4]*v[7]*(0.00001 + 0.00001i) + v[3]*v[5]*v[6]*(0.00001 + 0.00003i) + v[3]*v[5]*v[7]*0.00001i - v[4]*v[5]*v[6]*(0.00001 + 0.00003i) - v[4]*v[5]*v[7]*0.00001i)

    f[3]=- v[3]*15.4793i - 0.0338518*v[1]*v[3] - 0.00928785*v[1]*v[5] - 1.0*v[6]*(0.00308051*v[1]^3 + 0.16598*v[1]^2 + 2.98104*v[1]) + ka2*(- v[2]*v[3]*(0.00329 - 0.00786i) + v[2]*v[4]*(0.00165 - 0.00805i) - v[2]*v[5]*(0.00457 - 0.00683i) - v[3]*v[4]*(0.00165 - 0.00805i) + v[2]*v[6]*(0.00018 + 0.00007i) + v[3]*v[5]*(0.00457 - 0.00683i) + v[2]*v[7]*(0.00006 + 0.00002i) - v[3]*v[6]*(0.00018 + 0.00007i) - v[4]*v[5]*(0.00306 - 0.00731i) - v[3]*v[7]*(0.00006 + 0.00002i) + v[4]*v[6]*(0.00018 + 0.00004i) + v[4]*v[7]*(0.00006 + 0.00001i) - v[5]*v[6]*(0.00015 + 0.0001i) - v[5]*v[7]*(0.00005 + 0.00003i) + v[2]^2*(0.00164 - 0.00393i) + v[3]^2*(0.00164 - 0.00393i) + v[4]^2*(0.00004 - 0.00396i) + v[5]^2*(0.00279 - 0.00281i)) - 1.0*v[4]*(0.0338518*v[1]^2 + 1.21597*v[1]) - 1.0*v[7]*(0.00731249*v[1]^2 + 0.262668*v[1]) + ka3*(- v[2]*v[3]^2*(0.0007 + 0.00029i) + v[2]^2*v[3]*(0.0007 + 0.00029i) - v[2]*v[4]^2*(0.00071 + 0.00001i) - v[2]^2*v[4]*(0.00072 + 0.00015i) - v[2]*v[5]^2*(0.0005 + 0.0005i) + v[3]*v[4]^2*(0.00071 + 0.00001i) + v[2]^2*v[5]*(0.00061 + 0.00041i) - v[3]^2*v[4]*(0.00072 + 0.00015i) + v[3]*v[5]^2*(0.0005 + 0.0005i) + v[2]^2*v[6]*(0.00001 - 0.00002i) + v[3]^2*v[5]*(0.00061 + 0.00041i) - v[4]*v[5]^2*(0.00057 + 0.00038i) + v[3]^2*v[6]*(0.00001 - 0.00002i) + v[4]^2*v[5]*(0.00067 + 0.00014i) - v[4]^2*v[6]*0.00002i + v[5]^2*v[6]*(0.00001 - 0.00001i) - v[2]^3*(0.00023 + 0.0001i) + v[3]^3*(0.00023 + 0.0001i) - v[4]^3*(0.00022 - 0.00004i) + v[5]^3*(0.00013 + 0.00019i) + v[2]*v[3]*v[4]*(0.00144 + 0.0003i) - v[2]*v[3]*v[5]*(0.00122 + 0.00082i) - v[2]*v[3]*v[6]*(0.00001 - 0.00003i) + v[2]*v[4]*v[5]*(0.00131 + 0.00055i) + v[2]*v[3]*v[7]*0.00001i + v[2]*v[4]*v[6]*(0.00001 - 0.00003i) - v[3]*v[4]*v[5]*(0.00131 + 0.00055i) - v[2]*v[4]*v[7]*0.00001i - v[2]*v[5]*v[6]*(0.00002 - 0.00003i) - v[3]*v[4]*v[6]*(0.00001 - 0.00003i) - v[2]*v[5]*v[7]*(0.00001 - 0.00001i) + v[3]*v[4]*v[7]*0.00001i + v[3]*v[5]*v[6]*(0.00002 - 0.00003i) + v[3]*v[5]*v[7]*(0.00001 - 0.00001i) - v[4]*v[5]*v[6]*(0.00001 - 0.00003i) + v[4]*v[5]*v[7]*0.00001i)

    f[4]=- v[4]*(3.22105 - 16.4334i) + ka3*(0.00001*v[2]^2*v[7] + v[2]^2*v[3]*(0.00042 + 0.00167i) - v[2]*v[4]^2*(0.00095 + 0.00129i) - v[2]^2*v[4]*(0.00071 + 0.0015i) + v[2]*v[5]^2*(0.00022 - 0.00158i) + v[3]*v[4]^2*(0.00095 + 0.00129i) + v[2]^2*v[5]*(0.00009 + 0.00165i) - v[3]^2*v[4]*(0.00071 + 0.0015i) - v[3]*v[5]^2*(0.00022 - 0.00158i) + v[2]^2*v[6]*(0.00004 - 0.00001i) + v[3]^2*v[5]*(0.00009 + 0.00165i) - v[4]*v[5]^2*(0.00008 + 0.00154i) - v[2]*v[3]^2*(0.00042 + 0.00167i) + v[3]^2*v[6]*(0.00004 - 0.00001i) + v[4]^2*v[5]*(0.00066 + 0.00139i) + 0.00001*v[3]^2*v[7] + v[4]^2*v[6]*(0.00003 - 0.00002i) + v[4]^2*v[7]*(0.00001 - 0.00001i) + 0.00004*v[5]^2*v[6] + 0.00001*v[5]^2*v[7] - v[2]^3*(0.00014 + 0.00056i) + v[3]^3*(0.00014 + 0.00056i) - v[4]^3*(0.00038 + 0.00035i) - v[5]^3*(0.00017 - 0.00049i) + v[2]*v[3]*v[4]*(0.00142 + 0.003i) - v[2]*v[3]*v[5]*(0.00018 + 0.00331i) - v[2]*v[3]*v[6]*(0.00007 - 0.00002i) + v[2]*v[4]*v[5]*(0.00078 + 0.0031i) - v[2]*v[3]*v[7]*(0.00002 - 0.00001i) + v[2]*v[4]*v[6]*(0.00007 - 0.00003i) - v[3]*v[4]*v[5]*(0.00078 + 0.0031i) + v[2]*v[4]*v[7]*(0.00002 - 0.00001i) - 0.00007*v[2]*v[5]*v[6] - v[3]*v[4]*v[6]*(0.00007 - 0.00003i) - 0.00002*v[2]*v[5]*v[7] - v[3]*v[4]*v[7]*(0.00002 - 0.00001i) + 0.00007*v[3]*v[5]*v[6] + 0.00002*v[3]*v[5]*v[7] - v[4]*v[5]*v[6]*(0.00007 - 0.00002i) - v[4]*v[5]*v[7]*(0.00002 - 0.00001i)) + ka2*(- v[2]*v[3]*(0.01859 - 0.00471i) + v[2]*v[4]*(0.01672 - 0.00791i) - v[2]*v[5]*(0.01846 - 0.00101i) - v[3]*v[4]*(0.01672 - 0.00791i) + v[2]*v[6]*(0.00011 + 0.00042i) + v[3]*v[5]*(0.01846 - 0.00101i) + v[2]*v[7]*(0.00003 + 0.00013i) - v[3]*v[6]*(0.00011 + 0.00042i) - v[4]*v[5]*(0.01728 - 0.00438i) - v[3]*v[7]*(0.00003 + 0.00013i) + v[4]*v[6]*(0.00018 + 0.00037i) + v[4]*v[7]*(0.00006 + 0.00012i) - v[5]*v[6]*(0.00002 + 0.00041i) - v[5]*v[7]*(0.00001 + 0.00013i) + v[2]^2*(0.0093 - 0.00236i) + v[3]^2*(0.0093 - 0.00236i) + v[4]^2*(0.00717 - 0.00529i) + v[5]^2*(0.00883 + 0.00123i))

    f[5]=0.0385635*v[1]*v[3] + ka3*(v[2]*v[3]^2*(0.00042 - 0.00167i) - v[2]^2*v[3]*(0.00042 - 0.00167i) - v[2]*v[4]^2*(0.00022 + 0.00158i) + v[2]^2*v[4]*(0.00009 - 0.00165i) + v[2]*v[5]^2*(0.00095 - 0.00129i) + v[3]*v[4]^2*(0.00022 + 0.00158i) - v[2]^2*v[5]*(0.00071 - 0.0015i) + v[3]^2*v[4]*(0.00009 - 0.00165i) - v[3]*v[5]^2*(0.00095 - 0.00129i) + v[2]^2*v[6]*(0.00004 + 0.00001i) - v[3]^2*v[5]*(0.00071 - 0.0015i) + v[4]*v[5]^2*(0.00066 - 0.00139i) + 0.00001*v[2]^2*v[7] + v[3]^2*v[6]*(0.00004 + 0.00001i) - v[4]^2*v[5]*(0.00008 - 0.00154i) + 0.00001*v[3]^2*v[7] + 0.00004*v[4]^2*v[6] + 0.00001*v[4]^2*v[7] + v[5]^2*v[6]*(0.00003 + 0.00002i) + v[5]^2*v[7]*(0.00001 + 0.00001i) + v[2]^3*(0.00014 - 0.00056i) - v[3]^3*(0.00014 - 0.00056i) - v[4]^3*(0.00017 + 0.00049i) - v[5]^3*(0.00038 - 0.00035i) - v[2]*v[3]*v[4]*(0.00018 - 0.00331i) + v[2]*v[3]*v[5]*(0.00142 - 0.003i) - v[2]*v[3]*v[6]*(0.00007 + 0.00002i) - v[2]*v[4]*v[5]*(0.00078 - 0.0031i) - v[2]*v[3]*v[7]*(0.00002 + 0.00001i) + 0.00007*v[2]*v[4]*v[6] + v[3]*v[4]*v[5]*(0.00078 - 0.0031i) + 0.00002*v[2]*v[4]*v[7] - v[2]*v[5]*v[6]*(0.00007 + 0.00003i) - 0.00007*v[3]*v[4]*v[6] - v[2]*v[5]*v[7]*(0.00002 + 0.00001i) - 0.00002*v[3]*v[4]*v[7] + v[3]*v[5]*v[6]*(0.00007 + 0.00003i) + v[3]*v[5]*v[7]*(0.00002 + 0.00001i) - v[4]*v[5]*v[6]*(0.00007 + 0.00002i) - v[4]*v[5]*v[7]*(0.00002 + 0.00001i)) - v[5]*(3.22105 + 16.4334i) - 0.0631717*v[1]*v[5] + v[6]*(0.00350927*v[1]^3 + 0.189082*v[1]^2 + 3.39596*v[1]) + ka2*(- v[2]*v[3]*(0.01859 + 0.00471i) + v[2]*v[4]*(0.01846 + 0.00101i) - v[2]*v[5]*(0.01672 + 0.00791i) - v[3]*v[4]*(0.01846 + 0.00101i) - v[2]*v[6]*(0.00011 - 0.00042i) + v[3]*v[5]*(0.01672 + 0.00791i) - v[2]*v[7]*(0.00003 - 0.00013i) + v[3]*v[6]*(0.00011 - 0.00042i) - v[4]*v[5]*(0.01728 + 0.00438i) + v[3]*v[7]*(0.00003 - 0.00013i) - v[4]*v[6]*(0.00002 - 0.00041i) - v[4]*v[7]*(0.00001 - 0.00013i) + v[5]*v[6]*(0.00018 - 0.00037i) + v[5]*v[7]*(0.00006 - 0.00012i) + v[2]^2*(0.0093 + 0.00236i) + v[3]^2*(0.0093 + 0.00236i) + v[4]^2*(0.00883 - 0.00123i) + v[5]^2*(0.00717 + 0.00529i)) + v[7]*(0.00833028*v[1]^2 + 0.299228*v[1]) + v[4]*(0.0385635*v[1]^2 + 1.38522*v[1])

    f[6]=- 35.42*v[6] + ka2*(0.00156*v[2]^2 + v[2]*v[4]*(0.00296 - 0.00058i) - v[2]*v[5]*(0.00296 + 0.00058i) - v[3]*v[4]*(0.00296 - 0.00058i) + v[2]*v[6]*0.00007i + v[3]*v[5]*(0.00296 + 0.00058i) + v[2]*v[7]*0.00002i - v[3]*v[6]*0.00007i - 0.00291*v[4]*v[5] - v[3]*v[7]*0.00002i + v[4]*v[6]*(0.00001 + 0.00007i) + v[4]*v[7]*0.00002i + v[5]*v[6]*(0.00001 - 0.00007i) - v[5]*v[7]*0.00002i - 0.00313*v[2]*v[3] + 0.00156*v[3]^2 + v[4]^2*(0.00135 - 0.00055i) + v[5]^2*(0.00135 + 0.00055i)) - 1.0*ka3*(v[2]^3*0.00009i - v[2]^2*v[3]*0.00028i + v[2]^2*v[4]*(0.00005 + 0.00027i) + v[2]^2*v[5]*(0.00005 - 0.00027i) - 0.00001*v[6]*v[2]^2 + v[2]*v[3]^2*0.00028i - v[2]*v[3]*v[4]*(0.0001 + 0.00053i) - v[2]*v[3]*v[5]*(0.0001 - 0.00053i) + 0.00001*v[6]*v[2]*v[3] + v[2]*v[4]^2*(0.0001 + 0.00024i) - v[2]*v[4]*v[5]*0.00052i - 0.00001*v[6]*v[2]*v[4] - v[2]*v[5]^2*(0.0001 - 0.00024i) + 0.00001*v[6]*v[2]*v[5] - v[3]^3*0.00009i + v[3]^2*v[4]*(0.00005 + 0.00027i) + v[3]^2*v[5]*(0.00005 - 0.00027i) - 0.00001*v[6]*v[3]^2 - v[3]*v[4]^2*(0.0001 + 0.00024i) + v[3]*v[4]*v[5]*0.00052i + 0.00001*v[6]*v[3]*v[4] + v[3]*v[5]^2*(0.0001 - 0.00024i) - 0.00001*v[6]*v[3]*v[5] + v[4]^3*(0.00005 + 0.00007i) - v[4]^2*v[5]*(0.00005 + 0.00025i) - 0.00001*v[6]*v[4]^2 - v[4]*v[5]^2*(0.00005 - 0.00025i) + 0.00001*v[6]*v[4]*v[5] + v[5]^3*(0.00005 - 0.00007i) - 0.00001*v[6]*v[5]^2)

    f[7]=6.66667*v[1]*v[4] - 5.41329*v[7] - 2.30333*v[1]*v[7] + ka2*(0.00138*v[2]^2 + v[2]*v[4]*(0.00261 - 0.00051i) - v[2]*v[5]*(0.00261 + 0.00051i) - v[3]*v[4]*(0.00261 - 0.00051i) + v[2]*v[6]*0.00006i + v[3]*v[5]*(0.00261 + 0.00051i) + v[2]*v[7]*0.00002i - v[3]*v[6]*0.00006i - 0.00256*v[4]*v[5] - v[3]*v[7]*0.00002i + v[4]*v[6]*(0.00001 + 0.00006i) + v[4]*v[7]*0.00002i + v[5]*v[6]*(0.00001 - 0.00006i) - v[5]*v[7]*0.00002i - 0.00276*v[2]*v[3] + 0.00138*v[3]^2 + v[4]^2*(0.00119 - 0.00048i) + v[5]^2*(0.00119 + 0.00048i)) - 1.0*ka3*(v[2]^3*0.00008i - v[2]^2*v[3]*0.00025i + v[2]^2*v[4]*(0.00005 + 0.00023i) + v[2]^2*v[5]*(0.00005 - 0.00023i) - 0.00001*v[6]*v[2]^2 + v[2]*v[3]^2*0.00025i - v[2]*v[3]*v[4]*(0.00009 + 0.00047i) - v[2]*v[3]*v[5]*(0.00009 - 0.00047i) + 0.00001*v[6]*v[2]*v[3] + v[2]*v[4]^2*(0.00009 + 0.00021i) - v[2]*v[4]*v[5]*0.00046i - 0.00001*v[6]*v[2]*v[4] - v[2]*v[5]^2*(0.00009 - 0.00021i) + 0.00001*v[6]*v[2]*v[5] - v[3]^3*0.00008i + v[3]^2*v[4]*(0.00005 + 0.00023i) + v[3]^2*v[5]*(0.00005 - 0.00023i) - 0.00001*v[6]*v[3]^2 - v[3]*v[4]^2*(0.00009 + 0.00021i) + v[3]*v[4]*v[5]*0.00046i + 0.00001*v[6]*v[3]*v[4] + v[3]*v[5]^2*(0.00009 - 0.00021i) - 0.00001*v[6]*v[3]*v[5] + v[4]^3*(0.00004 + 0.00006i) - v[4]^2*v[5]*(0.00004 + 0.00022i) - v[4]*v[5]^2*(0.00004 - 0.00022i) + 0.00001*v[6]*v[4]*v[5] + v[5]^3*(0.00004 - 0.00006i)) - 1.0*v[6]*(0.606667*v[1]^2 + 21.7917*v[1])


    f[2] = f[2]/ω_h; f[3] = f[3]/ω_h; f[4] = f[4]/ω_h; f[5] = f[5]/ω_h; f[6] = f[6]/ω_h; f[7] = f[7]/ω_h

    return calculate_normal_form(f, v, norder, cm, m1, m2, m3, n, ω_h, zero_tol)
end


function example2()
    norder = 3; # Choose the order of power series representation of Centermanifold
    cm = 3; # Dimension of Centermanifold of the dynamical system
    m1 = 1; # Number of the zero eigenvalue corresponding to the center space of the Jacobian
    m2 = 1; # Number of pair of complex conjugate eigenvalue corresponding to the center space of the Jacobian
    m3 = 4; # Dimension of the stable manifold of the dynmical system
    n = m1+2*m2+m3; # Total dimension of the dynamical system
    ω_h = 15.1829; # Eigenvalue that crosses unit circle at Hopf bifurcation point ± ω_h
    zero_tol = 1e-11; # zero tolerance to chop out very small coeffs of symbolic computation

    v = [symbols("v_$i") for i in 1:n]; # Define state-space variables
    f = Array{Basic}(undef, n);

    @vars ka2, ka3, ν  # Define symbolic variables which is needed to define the equation of motion
    # In this example the variables are nonlinear stifness parameters

    # Define the equation of motion at the Hopf bifurcation point where the dimension of centermanifold is 2
    # Let the dimension of control parameter vector be 1, and express it as a one of state-space variable v[1]
    # d/dt v[1]=0 and let rest of the state-space variable be v[2],v[3],…,v[n].

    f[1]=0

    f[2]=v[2]*15.1829i - 1.0*ka2*(v[2]*v[3]*(0.00211 + 0.00537i) - v[2]*v[4]*(0.00357 + 0.00452i) + v[2]*v[5]*(0.00047 + 0.00574i) + v[3]*v[4]*(0.00357 + 0.00452i) - v[2]*v[6]*(0.00015 - 0.00006i) - v[3]*v[5]*(0.00047 + 0.00574i) + v[2]*v[7]*(0.00012 - 0.00005i) + v[3]*v[6]*(0.00015 - 0.00006i) + v[4]*v[5]*(0.00211 + 0.00535i) - v[3]*v[7]*(0.00012 - 0.00005i) - v[4]*v[6]*(0.00013 - 0.0001i) + v[4]*v[7]*(0.0001 - 0.00008i) + v[5]*v[6]*(0.00016 - 0.00001i) - v[5]*v[7]*(0.00013 - 0.00001i) - v[2]^2*(0.00106 + 0.00268i) - v[3]^2*(0.00106 + 0.00268i) - v[4]^2*(0.00235 + 0.00165i) + v[5]^2*(0.0006 - 0.00281i)) + ka3*(v[2]*v[3]^2*(0.00044 - 0.00017i) - v[2]^2*v[3]*(0.00044 - 0.00017i) + v[2]*v[4]^2*(0.00027 - 0.00039i) + v[2]^2*v[4]*(0.00037 - 0.00029i) + v[2]*v[5]^2*(0.00046 + 0.0001i) - v[3]*v[4]^2*(0.00027 - 0.00039i) - v[2]^2*v[5]*(0.00047 - 0.00004i) + v[3]^2*v[4]*(0.00037 - 0.00029i) - v[3]*v[5]^2*(0.00046 + 0.0001i) - v[2]^2*v[6]*0.00001i - v[3]^2*v[5]*(0.00047 - 0.00004i) + v[4]*v[5]^2*(0.00047 - 0.00004i) + v[2]^2*v[7]*0.00001i - v[3]^2*v[6]*0.00001i - v[4]^2*v[5]*(0.00037 - 0.00029i) + v[3]^2*v[7]*0.00001i - v[4]^2*v[6]*(0.00001 + 0.00001i) + v[4]^2*v[7]*(0.00001 + 0.00001i) - v[5]^2*v[6]*0.00001i + v[5]^2*v[7]*0.00001i + v[2]^3*(0.00015 - 0.00006i) - v[3]^3*(0.00015 - 0.00006i) + v[4]^3*(0.00005 - 0.00015i) - v[5]^3*(0.00014 + 0.00008i) - v[2]*v[3]*v[4]*(0.00074 - 0.00059i) + v[2]*v[3]*v[5]*(0.00094 - 0.00008i) + v[2]*v[3]*v[6]*(0.00001 + 0.00003i) - v[2]*v[4]*v[5]*(0.00088 - 0.00035i) - v[2]*v[3]*v[7]*(0.00001 + 0.00002i) - v[2]*v[4]*v[6]*(0.00002 + 0.00002i) + v[3]*v[4]*v[5]*(0.00088 - 0.00035i) + v[2]*v[4]*v[7]*(0.00001 + 0.00002i) + v[2]*v[5]*v[6]*0.00003i + v[3]*v[4]*v[6]*(0.00002 + 0.00002i) - v[2]*v[5]*v[7]*0.00002i - v[3]*v[4]*v[7]*(0.00001 + 0.00002i) - v[3]*v[5]*v[6]*0.00003i + v[3]*v[5]*v[7]*0.00002i + v[4]*v[5]*v[6]*(0.00001 + 0.00003i) - v[4]*v[5]*v[7]*(0.00001 + 0.00002i))

    f[3]=- v[3]*15.1829i - 0.0338296*v[1]*v[3] - 0.00930375*v[1]*v[5] - 1.0*v[6]*(0.00307849*v[1]^3 + 0.221185*v[1]^2 + 5.29728*v[1]) - 1.0*ka2*(v[2]*v[3]*(0.00211 - 0.00537i) - v[2]*v[4]*(0.00047 - 0.00574i) + v[2]*v[5]*(0.00357 - 0.00452i) + v[3]*v[4]*(0.00047 - 0.00574i) + v[2]*v[6]*(0.00015 + 0.00006i) - v[3]*v[5]*(0.00357 - 0.00452i) - v[2]*v[7]*(0.00012 + 0.00005i) - v[3]*v[6]*(0.00015 + 0.00006i) + v[4]*v[5]*(0.00211 - 0.00535i) + v[3]*v[7]*(0.00012 + 0.00005i) + v[4]*v[6]*(0.00016 + 0.00001i) - v[4]*v[7]*(0.00013 + 0.00001i) - v[5]*v[6]*(0.00013 + 0.0001i) + v[5]*v[7]*(0.0001 + 0.00008i) - v[2]^2*(0.00106 - 0.00268i) - v[3]^2*(0.00106 - 0.00268i) + v[4]^2*(0.0006 + 0.00281i) - v[5]^2*(0.00235 - 0.00165i)) - 1.0*v[4]*(0.0338296*v[1]^2 + 1.6204*v[1]) - 1.0*ka3*(v[2]*v[3]^2*(0.00044 + 0.00017i) - v[2]^2*v[3]*(0.00044 + 0.00017i) + v[2]*v[4]^2*(0.00046 - 0.0001i) + v[2]^2*v[4]*(0.00047 + 0.00004i) + v[2]*v[5]^2*(0.00027 + 0.00039i) - v[3]*v[4]^2*(0.00046 - 0.0001i) - v[2]^2*v[5]*(0.00037 + 0.00029i) + v[3]^2*v[4]*(0.00047 + 0.00004i) - v[3]*v[5]^2*(0.00027 + 0.00039i) - v[2]^2*v[6]*0.00001i - v[3]^2*v[5]*(0.00037 + 0.00029i) + v[4]*v[5]^2*(0.00037 + 0.00029i) + v[2]^2*v[7]*0.00001i - v[3]^2*v[6]*0.00001i - v[4]^2*v[5]*(0.00047 + 0.00004i) + v[3]^2*v[7]*0.00001i - v[4]^2*v[6]*0.00001i + v[4]^2*v[7]*0.00001i + v[5]^2*v[6]*(0.00001 - 0.00001i) - v[5]^2*v[7]*(0.00001 - 0.00001i) + v[2]^3*(0.00015 + 0.00006i) - v[3]^3*(0.00015 + 0.00006i) + v[4]^3*(0.00014 - 0.00008i) - v[5]^3*(0.00005 + 0.00015i) - v[2]*v[3]*v[4]*(0.00094 + 0.00008i) + v[2]*v[3]*v[5]*(0.00074 + 0.00059i) - v[2]*v[3]*v[6]*(0.00001 - 0.00003i) - v[2]*v[4]*v[5]*(0.00088 + 0.00035i) + v[2]*v[3]*v[7]*(0.00001 - 0.00002i) - v[2]*v[4]*v[6]*0.00003i + v[3]*v[4]*v[5]*(0.00088 + 0.00035i) + v[2]*v[4]*v[7]*0.00002i - v[2]*v[5]*v[6]*(0.00002 - 0.00002i) + v[3]*v[4]*v[6]*0.00003i + v[2]*v[5]*v[7]*(0.00001 - 0.00002i) - v[3]*v[4]*v[7]*0.00002i + v[3]*v[5]*v[6]*(0.00002 - 0.00002i) - v[3]*v[5]*v[7]*(0.00001 - 0.00002i) - v[4]*v[5]*v[6]*(0.00001 - 0.00003i) + v[4]*v[5]*v[7]*(0.00001 - 0.00002i)) - 1.0*v[7]*(0.0073077*v[1]^2 + 0.350032*v[1])

    f[4]=- v[4]*(5.05926 - 16.7804i) - 1.0*ka3*(v[2]*v[3]^2*(0.00006 + 0.00136i) - v[2]^2*v[3]*(0.00006 + 0.00136i) + v[2]*v[4]^2*(0.00079 + 0.0011i) + v[2]^2*v[4]*(0.00045 + 0.00128i) - v[2]*v[5]^2*(0.0007 - 0.00116i) - v[3]*v[4]^2*(0.00079 + 0.0011i) + v[2]^2*v[5]*(0.00034 - 0.00131i) + v[3]^2*v[4]*(0.00045 + 0.00128i) + v[3]*v[5]^2*(0.0007 - 0.00116i) + 0.00004*v[2]^2*v[6] + v[3]^2*v[5]*(0.00034 - 0.00131i) - v[4]*v[5]^2*(0.00034 - 0.00131i) - 0.00003*v[2]^2*v[7] + 0.00004*v[3]^2*v[6] - v[4]^2*v[5]*(0.00044 + 0.00128i) - 0.00003*v[3]^2*v[7] + v[4]^2*v[6]*(0.00003 - 0.00002i) - v[4]^2*v[7]*(0.00002 - 0.00002i) + v[5]^2*v[6]*(0.00003 + 0.00002i) - v[5]^2*v[7]*(0.00003 + 0.00002i) + v[2]^3*(0.00002 + 0.00045i) - v[3]^3*(0.00002 + 0.00045i) + v[4]^3*(0.00036 + 0.00027i) + v[5]^3*(0.00033 - 0.0003i) - v[2]*v[3]*v[4]*(0.00089 + 0.00256i) - v[2]*v[3]*v[5]*(0.00067 - 0.00263i) - 0.00008*v[2]*v[3]*v[6] - v[2]*v[4]*v[5]*(0.00011 + 0.0027i) + 0.00006*v[2]*v[3]*v[7] + v[2]*v[4]*v[6]*(0.00007 - 0.00003i) + v[3]*v[4]*v[5]*(0.00011 + 0.0027i) - v[2]*v[4]*v[7]*(0.00006 - 0.00002i) - v[2]*v[5]*v[6]*(0.00008 + 0.00002i) - v[3]*v[4]*v[6]*(0.00007 - 0.00003i) + v[2]*v[5]*v[7]*(0.00006 + 0.00001i) + v[3]*v[4]*v[7]*(0.00006 - 0.00002i) + v[3]*v[5]*v[6]*(0.00008 + 0.00002i) - v[3]*v[5]*v[7]*(0.00006 + 0.00001i) - 0.00008*v[4]*v[5]*v[6] + 0.00006*v[4]*v[5]*v[7]) + ka2*(v[2]^2*(0.00827 - 0.00035i) - v[2]*v[3]*(0.01654 - 0.0007i) + v[2]*v[4]*(0.0156 - 0.00543i) - v[2]*v[5]*(0.016 + 0.0041i) - v[2]*v[6]*(0.00002 + 0.00048i) + v[7]*v[2]*(0.00002 + 0.00036i) + v[3]^2*(0.00827 - 0.00035i) - v[3]*v[4]*(0.0156 - 0.00543i) + v[3]*v[5]*(0.016 + 0.0041i) + v[3]*v[6]*(0.00002 + 0.00048i) - v[7]*v[3]*(0.00002 + 0.00036i) + v[4]^2*(0.00667 - 0.00484i) - v[4]*v[5]*(0.01648 - 0.00069i) - v[4]*v[6]*(0.00016 + 0.00045i) + v[7]*v[4]*(0.00012 + 0.00034i) + v[5]^2*(0.00706 + 0.00426i) - v[5]*v[6]*(0.00012 - 0.00046i) + v[7]*v[5]*(0.00009 - 0.00035i) - 0.00001*v[6]^2 + 0.00001*v[7]*v[6])

    f[5]=0.0375611*v[1]*v[3] - v[5]*(5.05926 + 16.7804i) - 0.0633343*v[1]*v[5] - 1.0*ka3*(0.00004*v[2]^2*v[6] + v[2]^2*v[3]*(0.00006 - 0.00136i) + v[2]*v[4]^2*(0.0007 + 0.00116i) + v[2]^2*v[4]*(0.00034 + 0.00131i) - v[2]*v[5]^2*(0.00079 - 0.0011i) - v[3]*v[4]^2*(0.0007 + 0.00116i) + v[2]^2*v[5]*(0.00045 - 0.00128i) + v[3]^2*v[4]*(0.00034 + 0.00131i) + v[3]*v[5]^2*(0.00079 - 0.0011i) - v[2]*v[3]^2*(0.00006 - 0.00136i) + v[3]^2*v[5]*(0.00045 - 0.00128i) - v[4]*v[5]^2*(0.00044 - 0.00128i) - 0.00003*v[2]^2*v[7] + 0.00004*v[3]^2*v[6] - v[4]^2*v[5]*(0.00034 + 0.00131i) - 0.00003*v[3]^2*v[7] + v[4]^2*v[6]*(0.00003 - 0.00002i) - v[4]^2*v[7]*(0.00003 - 0.00002i) + v[5]^2*v[6]*(0.00003 + 0.00002i) - v[5]^2*v[7]*(0.00002 + 0.00002i) - v[2]^3*(0.00002 - 0.00045i) + v[3]^3*(0.00002 - 0.00045i) + v[4]^3*(0.00033 + 0.0003i) + v[5]^3*(0.00036 - 0.00027i) - v[2]*v[3]*v[4]*(0.00067 + 0.00263i) - v[2]*v[3]*v[5]*(0.00089 - 0.00256i) - 0.00008*v[2]*v[3]*v[6] + v[2]*v[4]*v[5]*(0.00011 - 0.0027i) + 0.00006*v[2]*v[3]*v[7] + v[2]*v[4]*v[6]*(0.00008 - 0.00002i) - v[3]*v[4]*v[5]*(0.00011 - 0.0027i) - v[2]*v[4]*v[7]*(0.00006 - 0.00001i) - v[2]*v[5]*v[6]*(0.00007 + 0.00003i) - v[3]*v[4]*v[6]*(0.00008 - 0.00002i) + v[2]*v[5]*v[7]*(0.00006 + 0.00002i) + v[3]*v[4]*v[7]*(0.00006 - 0.00001i) + v[3]*v[5]*v[6]*(0.00007 + 0.00003i) - v[3]*v[5]*v[7]*(0.00006 + 0.00002i) - 0.00008*v[4]*v[5]*v[6] + 0.00006*v[4]*v[5]*v[7]) + v[6]*(0.00341806*v[1]^3 + 0.245583*v[1]^2 + 5.88159*v[1]) + ka2*(v[2]^2*(0.00827 + 0.00035i) - v[2]*v[3]*(0.01654 + 0.0007i) + v[2]*v[4]*(0.016 - 0.0041i) - v[2]*v[5]*(0.0156 + 0.00543i) + v[2]*v[6]*(0.00002 - 0.00048i) - v[7]*v[2]*(0.00002 - 0.00036i) + v[3]^2*(0.00827 + 0.00035i) - v[3]*v[4]*(0.016 - 0.0041i) + v[3]*v[5]*(0.0156 + 0.00543i) - v[3]*v[6]*(0.00002 - 0.00048i) + v[7]*v[3]*(0.00002 - 0.00036i) + v[4]^2*(0.00706 - 0.00426i) - v[4]*v[5]*(0.01648 + 0.00069i) - v[4]*v[6]*(0.00012 + 0.00046i) + v[7]*v[4]*(0.00009 + 0.00035i) + v[5]^2*(0.00667 + 0.00484i) - v[5]*v[6]*(0.00016 - 0.00045i) + v[7]*v[5]*(0.00012 - 0.00034i) - 0.00001*v[6]^2 + 0.00001*v[7]*v[6]) + v[7]*(0.00811375*v[1]^2 + 0.388641*v[1]) + v[4]*(0.0375611*v[1]^2 + 1.79914*v[1])


    f[6]=- 47.1636*v[6] - 1.0*ka2*(0.00112*v[2]^2 + v[2]*v[4]*(0.00215 - 0.00065i) - v[2]*v[5]*(0.00215 + 0.00065i) - v[3]*v[4]*(0.00215 - 0.00065i) - v[2]*v[6]*0.00006i + v[3]*v[5]*(0.00215 + 0.00065i) + v[2]*v[7]*0.00005i + v[3]*v[6]*0.00006i - 0.00224*v[4]*v[5] - v[3]*v[7]*0.00005i - v[4]*v[6]*(0.00002 + 0.00006i) + v[4]*v[7]*(0.00001 + 0.00005i) - v[5]*v[6]*(0.00002 - 0.00006i) + v[5]*v[7]*(0.00001 - 0.00005i) - 0.00225*v[2]*v[3] + 0.00112*v[3]^2 + v[4]^2*(0.00093 - 0.00062i) + v[5]^2*(0.00093 + 0.00062i)) + ka3*(v[2]*v[3]^2*0.00018i - v[2]^2*v[3]*0.00018i + v[2]*v[4]^2*(0.0001 + 0.00015i) + v[2]^2*v[4]*(0.00005 + 0.00018i) - v[2]*v[5]^2*(0.0001 - 0.00015i) - v[3]*v[4]^2*(0.0001 + 0.00015i) + v[2]^2*v[5]*(0.00005 - 0.00018i) + v[3]^2*v[4]*(0.00005 + 0.00018i) + v[3]*v[5]^2*(0.0001 - 0.00015i) + 0.00001*v[2]^2*v[6] + v[3]^2*v[5]*(0.00005 - 0.00018i) - v[4]*v[5]^2*(0.00005 - 0.00018i) + 0.00001*v[3]^2*v[6] - v[4]^2*v[5]*(0.00005 + 0.00018i) + v[2]^3*0.00006i - v[3]^3*0.00006i + v[4]^3*(0.00005 + 0.00004i) + v[5]^3*(0.00005 - 0.00004i) - v[2]*v[3]*v[4]*(0.00011 + 0.00035i) - v[2]*v[3]*v[5]*(0.00011 - 0.00035i) - 0.00001*v[2]*v[3]*v[6] - v[2]*v[4]*v[5]*0.00037i + 0.00001*v[2]*v[3]*v[7] + 0.00001*v[2]*v[4]*v[6] + v[3]*v[4]*v[5]*0.00037i - 0.00001*v[2]*v[4]*v[7] - 0.00001*v[2]*v[5]*v[6] - 0.00001*v[3]*v[4]*v[6] + 0.00001*v[2]*v[5]*v[7] + 0.00001*v[3]*v[4]*v[7] + 0.00001*v[3]*v[5]*v[6] - 0.00001*v[3]*v[5]*v[7] - 0.00001*v[4]*v[5]*v[6] + 0.00001*v[4]*v[5]*v[7])

    f[7]=6.66667*v[1]*v[4] - 7.17103*v[7] - 2.30333*v[1]*v[7] - 1.0*ka3*(v[2]*v[3]^2*0.00024i - v[2]^2*v[3]*0.00024i + v[2]*v[4]^2*(0.00013 + 0.0002i) + v[2]^2*v[4]*(0.00007 + 0.00023i) - v[2]*v[5]^2*(0.00013 - 0.0002i) - v[3]*v[4]^2*(0.00013 + 0.0002i) + v[2]^2*v[5]*(0.00007 - 0.00023i) + v[3]^2*v[4]*(0.00007 + 0.00023i) + v[3]*v[5]^2*(0.00013 - 0.0002i) + 0.00001*v[2]^2*v[6] + v[3]^2*v[5]*(0.00007 - 0.00023i) - v[4]*v[5]^2*(0.00007 - 0.00022i) - 0.00001*v[2]^2*v[7] + 0.00001*v[3]^2*v[6] - v[4]^2*v[5]*(0.00007 + 0.00022i) - 0.00001*v[3]^2*v[7] + 0.00001*v[4]^2*v[6] + 0.00001*v[5]^2*v[6] + v[2]^3*0.00008i - v[3]^3*0.00008i + v[4]^3*(0.00006 + 0.00005i) + v[5]^3*(0.00006 - 0.00005i) - v[2]*v[3]*v[4]*(0.00014 + 0.00045i) - v[2]*v[3]*v[5]*(0.00014 - 0.00045i) - 0.00001*v[2]*v[3]*v[6] - v[2]*v[4]*v[5]*0.00047i + 0.00001*v[2]*v[3]*v[7] + 0.00001*v[2]*v[4]*v[6] + v[3]*v[4]*v[5]*0.00047i - 0.00001*v[2]*v[4]*v[7] - 0.00001*v[2]*v[5]*v[6] - 0.00001*v[3]*v[4]*v[6] + 0.00001*v[2]*v[5]*v[7] + 0.00001*v[3]*v[4]*v[7] + 0.00001*v[3]*v[5]*v[6] - 0.00001*v[3]*v[5]*v[7] - 0.00001*v[4]*v[5]*v[6] + 0.00001*v[4]*v[5]*v[7]) - 1.0*v[6]*(0.606667*v[1]^2 + 29.0588*v[1]) + ka2*(0.00144*v[2]^2 + v[2]*v[4]*(0.00275 - 0.00083i) - v[2]*v[5]*(0.00275 + 0.00083i) - v[3]*v[4]*(0.00275 - 0.00083i) - v[2]*v[6]*0.00008i + v[3]*v[5]*(0.00275 + 0.00083i) + v[2]*v[7]*0.00006i + v[3]*v[6]*0.00008i - 0.00287*v[4]*v[5] - v[3]*v[7]*0.00006i - v[4]*v[6]*(0.00002 + 0.00008i) + v[4]*v[7]*(0.00002 + 0.00006i) - v[5]*v[6]*(0.00002 - 0.00008i) + v[5]*v[7]*(0.00002 - 0.00006i) - 0.00288*v[2]*v[3] + 0.00144*v[3]^2 + v[4]^2*(0.0012 - 0.00079i) + v[5]^2*(0.0012 + 0.00079i))

    f[2] = f[2]/ω_h; f[3] = f[3]/ω_h; f[4] = f[4]/ω_h; f[5] = f[5]/ω_h; f[6] = f[6]/ω_h; f[7] = f[7]/ω_h;

    return calculate_normal_form(f, v, norder, cm, m1, m2, m3, n, ω_h, zero_tol)
end



end # module
