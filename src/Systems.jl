module Systems

using SymEngine
using ..HopfNormalForm: calculate_normal_form
const I=1im
const i=1im

function example1()
    norder = 3; # Choose the order of power series representation of Centermanifold
    cm = 3; # Dimension of Centermanifold of the dynamical system
    m1 = 1; # Number of the zero eigenvalue corresponding to the center space of the Jacobian
    m2 = 1; # Number of pair of complex conjugate eigenvalue corresponding to the center space of the Jacobian
    m3 = 4; # Dimension of the stable manifold of the dynmical system
    n = m1+2*m2+m3; # Total dimension of the dynamical system
    ω_h = 15.4793; # Eigenvalue that crosses unit circle at Hopf bifurcation point ± ω_h
    zero_tol = 1e-10; # zero tolerance to chop out very small coeffs of symbolic computation

    v = [symbols("v_$i") for i in 1:n]; # Define state-space variables
    f = Array{Basic}(undef, n);

    @vars ka2, ka3, ν  # Define symbolic variables which is needed to define the equation of motion
    # In this example the variables are nonlinear stifness parameters

    # Define the equation of motion at the Hopf bifurcation point where the dimension of centermanifold is 2
    # Let the dimension of control parameter vector be 1, and express it as a one of state-space variable v[1]
    # d/dt v[1]=0 and let rest of the state-space variable be v[2],v[3],…,v[n].

    f[1] = 0

    f[2]=v[2]*15.4793i + v[4]*(- v[1]^3*0.00005i + v[1]^2*(0.00521 - 0.00123i) + v[1]*(0.16797 + 0.01198i)) - 1.0*ka3*(- v[2]^3*(0.00004 - 0.00002i) + v[2]^2*v[3]*(0.00011 - 0.00005i) - v[2]^2*v[4]*(0.0001 - 0.00007i) + v[2]^2*v[5]*(0.00012 - 0.00003i) - v[2]*v[3]^2*(0.00011 - 0.00005i) + v[2]*v[3]*v[4]*(0.00019 - 0.00015i) - v[2]*v[3]*v[5]*(0.00023 - 0.00006i) + v[6]*v[2]*v[3]*0.00001i - v[2]*v[4]^2*(0.00008 - 0.00009i) + v[2]*v[4]*v[5]*(0.00021 - 0.0001i) - v[2]*v[5]^2*(0.00012 - 0.00001i) + v[6]*v[2]*v[5]*0.00001i + v[3]^3*(0.00004 - 0.00002i) - v[3]^2*v[4]*(0.0001 - 0.00007i) + v[3]^2*v[5]*(0.00012 - 0.00003i) + v[3]*v[4]^2*(0.00008 - 0.00009i) - v[3]*v[4]*v[5]*(0.00021 - 0.0001i) + v[3]*v[5]^2*(0.00012 - 0.00001i) - v[6]*v[3]*v[5]*0.00001i - v[4]^3*(0.00002 - 0.00003i) + v[4]^2*v[5]*(0.00009 - 0.00007i) - v[4]*v[5]^2*(0.00011 - 0.00003i) + 0.00004*v[5]^3) - 1.0*v[3]*(v[1]^3*0.00004i + v[1]^2*(0.00382 + 0.00282i) + v[1]*(0.15047 + 0.05733i)) - 1.0*v[5]*(- v[1]^3*(0.00003 - 0.00004i) + v[1]^2*(0.0024 + 0.00406i) + v[1]*(0.1282 + 0.10864i)) - 1.0*v[7]*(v[1]^3*(0.00029 - 0.00072i) + v[1]^2*(0.01322 - 0.01999i) + v[1]*(0.16776 - 0.21913i)) - 1.0*v[6]*(- v[1]^3*(0.00004 - 0.00011i) + v[1]^2*(0.00116 - 0.00492i) + v[1]*(0.11381 - 0.08774i)) + v[2]*(v[1]^3*(0.00003 - 0.00003i) + v[1]^2*(0.00508 + 0.00095i) + v[1]*(0.13615 + 0.05702i)) + ka2*(0.00001*v[3]*v[7] + v[2]*v[4]*(0.00081 + 0.00107i) - v[2]*v[5]*(0.00035 + 0.0013i) - v[3]*v[4]*(0.00081 + 0.00107i) - v[2]*v[6]*(0.00003 - 0.00001i) + v[3]*v[5]*(0.00035 + 0.0013i) - 0.00001*v[2]*v[7] + v[3]*v[6]*(0.00003 - 0.00001i) - v[4]*v[5]*(0.00057 + 0.00116i) - v[2]*v[3]*(0.00061 + 0.00125i) - v[4]*v[6]*(0.00002 - 0.00002i) - v[4]*v[7]*(0.00001 - 0.00001i) + v[5]*v[6]*(0.00003 - 0.00001i) + 0.00001*v[5]*v[7] + v[2]^2*(0.00031 + 0.00063i) + v[3]^2*(0.00031 + 0.00063i) + v[4]^2*(0.00048 + 0.00043i) + v[5]^2*(0.00004 + 0.00065i))

    f[3]=- v[3]*15.4793i + v[5]*(v[1]^3*0.00005i + v[1]^2*(0.00521 + 0.00123i) + v[1]*(0.16797 - 0.01198i)) + ka3*(- v[2]^3*(0.00004 + 0.00002i) + v[2]^2*v[3]*(0.00011 + 0.00005i) - v[2]^2*v[4]*(0.00012 + 0.00003i) + v[2]^2*v[5]*(0.0001 + 0.00007i) - v[2]*v[3]^2*(0.00011 + 0.00005i) + v[2]*v[3]*v[4]*(0.00023 + 0.00006i) - v[2]*v[3]*v[5]*(0.00019 + 0.00015i) + v[6]*v[2]*v[3]*0.00001i - v[2]*v[4]^2*(0.00012 + 0.00001i) + v[2]*v[4]*v[5]*(0.00021 + 0.0001i) - v[6]*v[2]*v[4]*0.00001i - v[2]*v[5]^2*(0.00008 + 0.00009i) + v[3]^3*(0.00004 + 0.00002i) - v[3]^2*v[4]*(0.00012 + 0.00003i) + v[3]^2*v[5]*(0.0001 + 0.00007i) + v[3]*v[4]^2*(0.00012 + 0.00001i) - v[3]*v[4]*v[5]*(0.00021 + 0.0001i) + v[6]*v[3]*v[4]*0.00001i + v[3]*v[5]^2*(0.00008 + 0.00009i) - 0.00004*v[4]^3 + v[4]^2*v[5]*(0.00011 + 0.00003i) - v[4]*v[5]^2*(0.00009 + 0.00007i) + v[5]^3*(0.00002 + 0.00003i)) - 1.0*v[2]*(- v[1]^3*0.00004i + v[1]^2*(0.00382 - 0.00282i) + v[1]*(0.15047 - 0.05733i)) - 1.0*v[4]*(- v[1]^3*(0.00003 + 0.00004i) + v[1]^2*(0.0024 - 0.00406i) + v[1]*(0.1282 - 0.10864i)) - 1.0*v[7]*(v[1]^3*(0.00029 + 0.00072i) + v[1]^2*(0.01322 + 0.01999i) + v[1]*(0.16776 + 0.21913i)) - 1.0*v[6]*(- v[1]^3*(0.00004 + 0.00011i) + v[1]^2*(0.00116 + 0.00492i) + v[1]*(0.11381 + 0.08774i)) + v[3]*(v[1]^3*(0.00003 + 0.00003i) + v[1]^2*(0.00508 - 0.00095i) + v[1]*(0.13615 - 0.05702i)) + ka2*(0.00001*v[2]*v[7] + v[2]*v[4]*(0.00035 - 0.0013i) - v[2]*v[5]*(0.00081 - 0.00107i) - v[3]*v[4]*(0.00035 - 0.0013i) + v[2]*v[6]*(0.00003 + 0.00001i) + v[3]*v[5]*(0.00081 - 0.00107i) - v[2]*v[3]*(0.00061 - 0.00125i) - v[3]*v[6]*(0.00003 + 0.00001i) - v[4]*v[5]*(0.00057 - 0.00116i) - 0.00001*v[3]*v[7] + v[4]*v[6]*(0.00003 + 0.00001i) + 0.00001*v[4]*v[7] - v[5]*v[6]*(0.00002 + 0.00002i) - v[5]*v[7]*(0.00001 + 0.00001i) + v[2]^2*(0.00031 - 0.00063i) + v[3]^2*(0.00031 - 0.00063i) + v[4]^2*(0.00004 - 0.00065i) + v[5]^2*(0.00048 - 0.00043i))

    f[4]=- v[4]*(3.22105 - 16.4334i) - 1.0*ka3*(v[2]^3*(0.00002 + 0.00009i) - v[2]^2*v[3]*(0.00006 + 0.00028i) + v[2]^2*v[4]*(0.00011 + 0.00025i) - v[2]^2*v[5]*(0.00001 + 0.00028i) - 0.00001*v[6]*v[2]^2 + v[2]*v[3]^2*(0.00006 + 0.00028i) - v[2]*v[3]*v[4]*(0.00023 + 0.00051i) + v[2]*v[3]*v[5]*(0.00002 + 0.00055i) + 0.00001*v[6]*v[2]*v[3] + v[2]*v[4]^2*(0.00015 + 0.00022i) - v[2]*v[4]*v[5]*(0.00012 + 0.00052i) - v[6]*v[2]*v[4]*(0.00001 - 0.00001i) - v[2]*v[5]^2*(0.00004 - 0.00026i) + 0.00001*v[6]*v[2]*v[5] - v[3]^3*(0.00002 + 0.00009i) + v[3]^2*v[4]*(0.00011 + 0.00025i) - v[3]^2*v[5]*(0.00001 + 0.00028i) - 0.00001*v[6]*v[3]^2 - v[3]*v[4]^2*(0.00015 + 0.00022i) + v[3]*v[4]*v[5]*(0.00012 + 0.00052i) + v[6]*v[3]*v[4]*(0.00001 - 0.00001i) + v[3]*v[5]^2*(0.00004 - 0.00026i) - 0.00001*v[6]*v[3]*v[5] + v[4]^3*(0.00006 + 0.00006i) - v[4]^2*v[5]*(0.0001 + 0.00024i) + v[4]*v[5]^2*(0.00001 + 0.00026i) + 0.00001*v[6]*v[4]*v[5] + v[5]^3*(0.00003 - 0.00008i) - 0.00001*v[6]*v[5]^2) - 1.0*v[2]*(v[1]^3*(0.00004 - 0.00002i) + v[1]^2*(0.00502 + 0.00319i) + v[1]*(0.1521 + 0.12679i)) + v[7]*(v[1]^3*(0.00061 - 0.00064i) + v[1]^2*(0.02313 - 0.01503i) + v[1]*(0.28071 - 0.15246i)) + v[6]*(- v[1]^3*(0.00009 - 0.0001i) + v[1]^2*(0.00321 - 0.00483i) + v[1]*(0.16929 - 0.0353i)) + v[3]*(- v[1]^3*(0.00002 - 0.00004i) + v[1]^2*(0.00282 + 0.00459i) + v[1]*(0.10428 + 0.11572i)) + v[5]*(- v[1]^3*(0.00005 - 0.00003i) + v[1]^2*(0.0008 + 0.00527i) + v[1]*(0.05645 + 0.15966i)) + ka2*(- v[2]*v[3]*(0.00313 - 0.00072i) + v[2]*v[4]*(0.00282 - 0.00126i) - v[2]*v[5]*(0.00309 - 0.0001i) - v[3]*v[4]*(0.00282 - 0.00126i) + v[2]*v[6]*(0.00002 + 0.00007i) + v[3]*v[5]*(0.00309 - 0.0001i) + v[2]*v[7]*(0.00001 + 0.00002i) - v[3]*v[6]*(0.00002 + 0.00007i) - v[4]*v[5]*(0.00291 - 0.00067i) - v[3]*v[7]*(0.00001 + 0.00002i) + v[4]*v[6]*(0.00003 + 0.00006i) + v[4]*v[7]*(0.00001 + 0.00002i) - v[5]*v[6]*0.00007i - v[5]*v[7]*0.00002i + v[2]^2*(0.00156 - 0.00036i) + v[3]^2*(0.00156 - 0.00036i) + v[4]^2*(0.00122 - 0.00086i) + v[5]^2*(0.00147 + 0.00024i)) - 1.0*v[4]*(v[1]^3*(0.00003 - 0.00006i) + v[1]^2*(0.00611 + 0.00091i) + v[1]*(0.20713 + 0.09386i))

    f[5]=- v[5]*(3.22105 + 16.4334i) - 1.0*ka3*(- v[2]^3*(0.00002 - 0.00009i) + v[2]^2*v[3]*(0.00006 - 0.00028i) - v[2]^2*v[4]*(0.00001 - 0.00028i) + v[2]^2*v[5]*(0.00011 - 0.00025i) - 0.00001*v[6]*v[2]^2 - v[2]*v[3]^2*(0.00006 - 0.00028i) + v[2]*v[3]*v[4]*(0.00002 - 0.00055i) - v[2]*v[3]*v[5]*(0.00023 - 0.00051i) + 0.00001*v[6]*v[2]*v[3] + v[2]*v[4]^2*(0.00004 + 0.00026i) + v[2]*v[4]*v[5]*(0.00012 - 0.00052i) - 0.00001*v[6]*v[2]*v[4] - v[2]*v[5]^2*(0.00015 - 0.00022i) + v[6]*v[2]*v[5]*(0.00001 + 0.00001i) + v[3]^3*(0.00002 - 0.00009i) - v[3]^2*v[4]*(0.00001 - 0.00028i) + v[3]^2*v[5]*(0.00011 - 0.00025i) - 0.00001*v[6]*v[3]^2 - v[3]*v[4]^2*(0.00004 + 0.00026i) - v[3]*v[4]*v[5]*(0.00012 - 0.00052i) + 0.00001*v[6]*v[3]*v[4] + v[3]*v[5]^2*(0.00015 - 0.00022i) - v[6]*v[3]*v[5]*(0.00001 + 0.00001i) + v[4]^3*(0.00003 + 0.00008i) + v[4]^2*v[5]*(0.00001 - 0.00026i) - 0.00001*v[6]*v[4]^2 - v[4]*v[5]^2*(0.0001 - 0.00024i) + 0.00001*v[6]*v[4]*v[5] + v[5]^3*(0.00006 - 0.00006i)) - 1.0*v[3]*(v[1]^3*(0.00004 + 0.00002i) + v[1]^2*(0.00502 - 0.00319i) + v[1]*(0.1521 - 0.12679i)) + v[7]*(v[1]^3*(0.00061 + 0.00064i) + v[1]^2*(0.02313 + 0.01503i) + v[1]*(0.28071 + 0.15246i)) + v[6]*(- v[1]^3*(0.00009 + 0.0001i) + v[1]^2*(0.00321 + 0.00483i) + v[1]*(0.16929 + 0.0353i)) + v[2]*(- v[1]^3*(0.00002 + 0.00004i) + v[1]^2*(0.00282 - 0.00459i) + v[1]*(0.10428 - 0.11572i)) + v[4]*(- v[1]^3*(0.00005 + 0.00003i) + v[1]^2*(0.0008 - 0.00527i) + v[1]*(0.05645 - 0.15966i)) + ka2*(- v[2]*v[3]*(0.00313 + 0.00072i) + v[2]*v[4]*(0.00309 + 0.0001i) - v[2]*v[5]*(0.00282 + 0.00126i) - v[3]*v[4]*(0.00309 + 0.0001i) - v[2]*v[6]*(0.00002 - 0.00007i) + v[3]*v[5]*(0.00282 + 0.00126i) - v[2]*v[7]*(0.00001 - 0.00002i) + v[3]*v[6]*(0.00002 - 0.00007i) - v[4]*v[5]*(0.00291 + 0.00067i) + v[3]*v[7]*(0.00001 - 0.00002i) + v[4]*v[6]*0.00007i + v[4]*v[7]*0.00002i + v[5]*v[6]*(0.00003 - 0.00006i) + v[5]*v[7]*(0.00001 - 0.00002i) + v[2]^2*(0.00156 + 0.00036i) + v[3]^2*(0.00156 + 0.00036i) + v[4]^2*(0.00147 - 0.00024i) + v[5]^2*(0.00122 + 0.00086i)) - 1.0*v[5]*(v[1]^3*(0.00003 + 0.00006i) + v[1]^2*(0.00611 - 0.00091i) + v[1]*(0.20713 - 0.09386i))

    f[6]=- 35.42*v[6] + v[2]*(- 0.00001*v[1]^3 + v[1]^2*(0.00619 + 0.0015i) + v[1]*(0.08332 - 0.03814i)) + v[3]*(- 0.00001*v[1]^3 + v[1]^2*(0.00619 - 0.0015i) + v[1]*(0.08332 + 0.03814i)) + ka2*(0.00026*v[2]^2 - 0.00052*v[2]*v[3] + v[2]*v[4]*(0.00049 - 0.0001i) - v[2]*v[5]*(0.00049 + 0.0001i) + v[6]*v[2]*0.00001i + 0.00026*v[3]^2 - v[3]*v[4]*(0.00049 - 0.0001i) + v[3]*v[5]*(0.00049 + 0.0001i) - v[6]*v[3]*0.00001i + v[4]^2*(0.00022 - 0.00009i) - 0.00048*v[4]*v[5] + v[6]*v[4]*0.00001i + v[5]^2*(0.00022 + 0.00009i) - v[6]*v[5]*0.00001i) - 1.0*v[7]*(- 0.00015*v[1]^3 + 0.12602*v[1]^2 + 1.95201*v[1]) - 1.0*v[6]*(0.00002*v[1]^3 - 0.02125*v[1]^2 + 1.96145*v[1]) - 1.0*ka3*(v[2]^3*0.00002i - v[2]^2*v[3]*0.00005i + v[2]^2*v[4]*(0.00001 + 0.00004i) + v[2]^2*v[5]*(0.00001 - 0.00004i) + v[2]*v[3]^2*0.00005i - v[2]*v[3]*v[4]*(0.00002 + 0.00009i) - v[2]*v[3]*v[5]*(0.00002 - 0.00009i) + v[2]*v[4]^2*(0.00002 + 0.00004i) - v[2]*v[4]*v[5]*0.00009i - v[2]*v[5]^2*(0.00002 - 0.00004i) - v[3]^3*0.00002i + v[3]^2*v[4]*(0.00001 + 0.00004i) + v[3]^2*v[5]*(0.00001 - 0.00004i) - v[3]*v[4]^2*(0.00002 + 0.00004i) + v[3]*v[4]*v[5]*0.00009i + v[3]*v[5]^2*(0.00002 - 0.00004i) + v[4]^3*(0.00001 + 0.00001i) - v[4]^2*v[5]*(0.00001 + 0.00004i) - v[4]*v[5]^2*(0.00001 - 0.00004i) + v[5]^3*(0.00001 - 0.00001i)) + v[4]*(- 0.00001*v[1]^3 + v[1]^2*(0.00801 - 0.00361i) + v[1]*(0.27763 - 0.00848i)) + v[5]*(- 0.00001*v[1]^3 + v[1]^2*(0.00801 + 0.00361i) + v[1]*(0.27763 + 0.00848i))

    f[7]=- 5.41329*v[7] + ka2*(0.00024*v[2]^2 - 0.00047*v[2]*v[3] + v[2]*v[4]*(0.00045 - 0.00009i) - v[2]*v[5]*(0.00045 + 0.00009i) + v[6]*v[2]*0.00001i + 0.00024*v[3]^2 - v[3]*v[4]*(0.00045 - 0.00009i) + v[3]*v[5]*(0.00045 + 0.00009i) - v[6]*v[3]*0.00001i + v[4]^2*(0.0002 - 0.00008i) - 0.00044*v[4]*v[5] + v[6]*v[4]*0.00001i + v[5]^2*(0.0002 + 0.00008i) - v[6]*v[5]*0.00001i) - 1.0*v[7]*(- 0.00002*v[1]^3 + 0.01919*v[1]^2 + 0.29695*v[1]) + v[4]*(v[1]^2*(0.00122 - 0.00054i) + v[1]*(0.03831 - 0.00086i)) + v[5]*(v[1]^2*(0.00122 + 0.00054i) + v[1]*(0.03831 + 0.00086i)) - 1.0*ka3*(v[2]^3*0.00001i - v[2]^2*v[3]*0.00004i + v[2]^2*v[4]*(0.00001 + 0.00004i) + v[2]^2*v[5]*(0.00001 - 0.00004i) + v[2]*v[3]^2*0.00004i - v[2]*v[3]*v[4]*(0.00002 + 0.00008i) - v[2]*v[3]*v[5]*(0.00002 - 0.00008i) + v[2]*v[4]^2*(0.00001 + 0.00004i) - v[2]*v[4]*v[5]*0.00008i - v[2]*v[5]^2*(0.00001 - 0.00004i) - v[3]^3*0.00001i + v[3]^2*v[4]*(0.00001 + 0.00004i) + v[3]^2*v[5]*(0.00001 - 0.00004i) - v[3]*v[4]^2*(0.00001 + 0.00004i) + v[3]*v[4]*v[5]*0.00008i + v[3]*v[5]^2*(0.00001 - 0.00004i) + v[4]^3*(0.00001 + 0.00001i) - v[4]^2*v[5]*(0.00001 + 0.00004i) - v[4]*v[5]^2*(0.00001 - 0.00004i) + v[5]^3*(0.00001 - 0.00001i)) + v[2]*(v[1]^2*(0.00094 + 0.00024i) + v[1]*(0.00884 - 0.00537i)) + v[3]*(v[1]^2*(0.00094 - 0.00024i) + v[1]*(0.00884 + 0.00537i)) - 1.0*v[6]*(- 0.00321*v[1]^2 + 0.29782*v[1])

    f[2] = f[2]/ω_h; f[3] = f[3]/ω_h; f[4] = f[4]/ω_h; f[5] = f[5]/ω_h; f[6] = f[6]/ω_h; f[7] = f[7]/ω_h

    return calculate_normal_form(f, v, norder, cm, m1, m2, m3, n, ω_h, zero_tol)
end


function example2()
    norder = 3; # Choose the order of power series representation of Centermanifold
    cm = 3; # Dimension of Centermanifold of the dynamical system
    m1 = 1; # Number of the zero eigenvalue corresponding to the center space of the Jacobian
    m2 = 1; # Number of pair of complex conjugate eigenvalue corresponding to the center space of the Jacobian
    m3 = 4; # Dimension of the stable manifold of the dynmical system
    n = m1+2*m2+m3; # Total dimension of the dynamical system
    ω_h = 15.1829; # Eigenvalue that crosses unit circle at Hopf bifurcation point ± ω_h
    zero_tol = 1e-10; # zero tolerance to chop out very small coeffs of symbolic computation

    v = [symbols("v_$i") for i in 1:n]; # Define state-space variables
    f = Array{Basic}(undef, n);

    @vars ka2, ka3, ν  # Define symbolic variables which is needed to define the equation of motion
    # In this example the variables are nonlinear stifness parameters

    # Define the equation of motion at the Hopf bifurcation point where the dimension of centermanifold is 2
    # Let the dimension of control parameter vector be 1, and express it as a one of state-space variable v[1]
    # d/dt v[1]=0 and let rest of the state-space variable be v[2],v[3],…,v[n].

    f[1] = 0

    f[2]=v[2]*15.1829i + v[4]*(- v[1]^3*0.00003i + v[1]^2*(0.00344 - 0.00109i) + v[1]*(0.14301 + 0.00226i)) - 1.0*v[3]*(v[1]^3*0.00002i + v[1]^2*(0.00241 + 0.0019i) + v[1]*(0.12039 + 0.05276i)) - 1.0*v[7]*(v[1]^3*(0.00017 - 0.00035i) + v[1]^2*(0.00928 - 0.01223i) + v[1]*(0.15414 - 0.17644i)) + v[2]*(v[1]^3*(0.00002 - 0.00001i) + v[1]^2*(0.00315 + 0.00104i) + v[1]*(0.10313 + 0.05723i)) - 1.0*ka2*(v[2]*v[3]*(0.00039 + 0.00087i) - v[2]*v[4]*(0.00063 + 0.00072i) + v[2]*v[5]*(0.00012 + 0.00095i) + v[3]*v[4]*(0.00063 + 0.00072i) - v[2]*v[6]*(0.00003 - 0.00001i) - v[3]*v[5]*(0.00012 + 0.00095i) + v[2]*v[7]*(0.00002 - 0.00001i) + v[3]*v[6]*(0.00003 - 0.00001i) + v[4]*v[5]*(0.00039 + 0.00087i) - v[3]*v[7]*(0.00002 - 0.00001i) - v[4]*v[6]*(0.00002 - 0.00002i) + v[4]*v[7]*(0.00002 - 0.00001i) + 0.00003*v[5]*v[6] - 0.00002*v[5]*v[7] - v[2]^2*(0.0002 + 0.00044i) - v[3]^2*(0.0002 + 0.00044i) - v[4]^2*(0.0004 + 0.00025i) + v[5]^2*(0.00008 - 0.00047i)) + v[6]*(- v[1]^3*(0.00003 - 0.00005i) + v[1]^2*(0.00107 - 0.00323i) + v[1]*(0.09493 - 0.06065i)) - 1.0*v[5]*(- v[1]^3*(0.00003 - 0.00002i) + v[1]^2*(0.0009 + 0.00299i) + v[1]*(0.08796 + 0.11187i)) + ka3*(v[2]^3*(0.00002 - 0.00001i) - v[2]^2*v[3]*(0.00007 - 0.00003i) + v[2]^2*v[4]*(0.00006 - 0.00005i) - v[2]^2*v[5]*(0.00008 - 0.00001i) + v[2]*v[3]^2*(0.00007 - 0.00003i) - v[2]*v[3]*v[4]*(0.00012 - 0.0001i) + v[2]*v[3]*v[5]*(0.00016 - 0.00002i) + v[2]*v[4]^2*(0.00004 - 0.00007i) - v[2]*v[4]*v[5]*(0.00014 - 0.00006i) + v[2]*v[5]^2*(0.00008 + 0.00001i) - v[3]^3*(0.00002 - 0.00001i) + v[3]^2*v[4]*(0.00006 - 0.00005i) - v[3]^2*v[5]*(0.00008 - 0.00001i) - v[3]*v[4]^2*(0.00004 - 0.00007i) + v[3]*v[4]*v[5]*(0.00014 - 0.00006i) - v[3]*v[5]^2*(0.00008 + 0.00001i) + v[4]^3*(0.00001 - 0.00003i) - v[4]^2*v[5]*(0.00006 - 0.00005i) + v[4]*v[5]^2*(0.00008 - 0.00001i) - v[5]^3*(0.00002 + 0.00001i))

    f[3]=- v[3]*15.1829i + v[5]*(v[1]^3*0.00003i + v[1]^2*(0.00344 + 0.00109i) + v[1]*(0.14301 - 0.00226i)) - 1.0*v[2]*(- v[1]^3*0.00002i + v[1]^2*(0.00241 - 0.0019i) + v[1]*(0.12039 - 0.05276i)) - 1.0*v[7]*(v[1]^3*(0.00017 + 0.00035i) + v[1]^2*(0.00928 + 0.01223i) + v[1]*(0.15414 + 0.17644i)) + v[3]*(v[1]^3*(0.00002 + 0.00001i) + v[1]^2*(0.00315 - 0.00104i) + v[1]*(0.10313 - 0.05723i)) - 1.0*ka2*(v[2]*v[3]*(0.00039 - 0.00087i) - v[2]*v[4]*(0.00012 - 0.00095i) + v[2]*v[5]*(0.00063 - 0.00072i) + v[3]*v[4]*(0.00012 - 0.00095i) + v[2]*v[6]*(0.00003 + 0.00001i) - v[3]*v[5]*(0.00063 - 0.00072i) - v[2]*v[7]*(0.00002 + 0.00001i) - v[3]*v[6]*(0.00003 + 0.00001i) + v[4]*v[5]*(0.00039 - 0.00087i) + v[3]*v[7]*(0.00002 + 0.00001i) + 0.00003*v[4]*v[6] - 0.00002*v[4]*v[7] - v[5]*v[6]*(0.00002 + 0.00002i) + v[5]*v[7]*(0.00002 + 0.00001i) - v[2]^2*(0.0002 - 0.00044i) - v[3]^2*(0.0002 - 0.00044i) + v[4]^2*(0.00008 + 0.00047i) - v[5]^2*(0.0004 - 0.00025i)) + v[6]*(- v[1]^3*(0.00003 + 0.00005i) + v[1]^2*(0.00107 + 0.00323i) + v[1]*(0.09493 + 0.06065i)) - 1.0*v[4]*(- v[1]^3*(0.00003 + 0.00002i) + v[1]^2*(0.0009 - 0.00299i) + v[1]*(0.08796 - 0.11187i)) - 1.0*ka3*(v[2]^3*(0.00002 + 0.00001i) - v[2]^2*v[3]*(0.00007 + 0.00003i) + v[2]^2*v[4]*(0.00008 + 0.00001i) - v[2]^2*v[5]*(0.00006 + 0.00005i) + v[2]*v[3]^2*(0.00007 + 0.00003i) - v[2]*v[3]*v[4]*(0.00016 + 0.00002i) + v[2]*v[3]*v[5]*(0.00012 + 0.0001i) + v[2]*v[4]^2*(0.00008 - 0.00001i) - v[2]*v[4]*v[5]*(0.00014 + 0.00006i) + v[2]*v[5]^2*(0.00004 + 0.00007i) - v[3]^3*(0.00002 + 0.00001i) + v[3]^2*v[4]*(0.00008 + 0.00001i) - v[3]^2*v[5]*(0.00006 + 0.00005i) - v[3]*v[4]^2*(0.00008 - 0.00001i) + v[3]*v[4]*v[5]*(0.00014 + 0.00006i) - v[3]*v[5]^2*(0.00004 + 0.00007i) + v[4]^3*(0.00002 - 0.00001i) - v[4]^2*v[5]*(0.00008 + 0.00001i) + v[4]*v[5]^2*(0.00006 + 0.00005i) - v[5]^3*(0.00001 + 0.00003i))

    f[4]=- v[4]*(5.05926 - 16.7804i) + v[7]*(v[1]^3*(0.0004 - 0.00025i) + v[1]^2*(0.0178 - 0.00583i) + v[1]*(0.28061 - 0.0667i)) - 1.0*v[2]*(0.00003*v[1]^3 + v[1]^2*(0.00254 + 0.00314i) + v[1]*(0.09545 + 0.13596i)) - 1.0*ka3*(v[2]*v[3]^2*(0.00001 + 0.00023i) - v[2]^2*v[3]*(0.00001 + 0.00023i) + v[2]*v[4]^2*(0.00013 + 0.00019i) + v[2]^2*v[4]*(0.00007 + 0.00022i) - v[2]*v[5]^2*(0.00012 - 0.00019i) - v[3]*v[4]^2*(0.00013 + 0.00019i) + v[2]^2*v[5]*(0.00006 - 0.00022i) + v[3]^2*v[4]*(0.00007 + 0.00022i) + v[3]*v[5]^2*(0.00012 - 0.00019i) + 0.00001*v[2]^2*v[6] + v[3]^2*v[5]*(0.00006 - 0.00022i) - v[4]*v[5]^2*(0.00006 - 0.00022i) - 0.00001*v[2]^2*v[7] + 0.00001*v[3]^2*v[6] - v[4]^2*v[5]*(0.00007 + 0.00022i) - 0.00001*v[3]^2*v[7] + 0.00001*v[4]^2*v[6] + 0.00001*v[5]^2*v[6] + v[2]^3*0.00008i - v[3]^3*0.00008i + v[4]^3*(0.00006 + 0.00005i) + v[5]^3*(0.00006 - 0.00005i) - v[2]*v[3]*v[4]*(0.00015 + 0.00044i) - v[2]*v[3]*v[5]*(0.00012 - 0.00044i) - 0.00001*v[2]*v[3]*v[6] - v[2]*v[4]*v[5]*(0.00001 + 0.00046i) + 0.00001*v[2]*v[3]*v[7] + 0.00001*v[2]*v[4]*v[6] + v[3]*v[4]*v[5]*(0.00001 + 0.00046i) - 0.00001*v[2]*v[4]*v[7] - 0.00001*v[2]*v[5]*v[6] - 0.00001*v[3]*v[4]*v[6] + 0.00001*v[2]*v[5]*v[7] + 0.00001*v[3]*v[4]*v[7] + 0.00001*v[3]*v[5]*v[6] - 0.00001*v[3]*v[5]*v[7] - 0.00001*v[4]*v[5]*v[6] + 0.00001*v[4]*v[5]*v[7]) + ka2*(- v[2]*v[3]*(0.0028 - 0.00008i) + v[2]*v[4]*(0.00265 - 0.00088i) - v[2]*v[5]*(0.0027 + 0.00073i) - v[3]*v[4]*(0.00265 - 0.00088i) - v[2]*v[6]*0.00008i + v[3]*v[5]*(0.0027 + 0.00073i) + v[2]*v[7]*0.00006i + v[3]*v[6]*0.00008i - v[4]*v[5]*(0.00279 - 0.00008i) - v[3]*v[7]*0.00006i - v[4]*v[6]*(0.00003 + 0.00008i) + v[4]*v[7]*(0.00002 + 0.00006i) - v[5]*v[6]*(0.00002 - 0.00008i) + v[5]*v[7]*(0.00002 - 0.00006i) + v[2]^2*(0.0014 - 0.00004i) + v[3]^2*(0.0014 - 0.00004i) + v[4]^2*(0.00114 - 0.0008i) + v[5]^2*(0.00119 + 0.00074i)) - 1.0*v[5]*(v[1]^3*(0.00004 - 0.00001i) + v[1]^2*(0.00103 - 0.00356i) + v[1]*(0.01494 - 0.15625i)) - 1.0*v[6]*(- v[1]^3*(0.00006 - 0.00004i) + v[1]^2*(0.0031 - 0.00272i) + v[1]*(0.14746 + 0.01382i)) - 1.0*v[4]*(v[1]^3*(0.00003 - 0.00003i) + v[1]^2*(0.00427 + 0.00114i) + v[1]*(0.17694 + 0.10919i)) + v[3]*(- v[1]^3*(0.00001 - 0.00003i) + v[1]^2*(0.00119 + 0.00348i) + v[1]*(0.06171 + 0.12039i))

    f[5]=- v[5]*(5.05926 + 16.7804i) + v[7]*(v[1]^3*(0.0004 + 0.00025i) + v[1]^2*(0.0178 + 0.00583i) + v[1]*(0.28061 + 0.0667i)) - 1.0*v[3]*(0.00003*v[1]^3 + v[1]^2*(0.00254 - 0.00314i) + v[1]*(0.09545 - 0.13596i)) - 1.0*ka3*(0.00001*v[2]^2*v[6] + v[2]^2*v[3]*(0.00001 - 0.00023i) + v[2]*v[4]^2*(0.00012 + 0.00019i) + v[2]^2*v[4]*(0.00006 + 0.00022i) - v[2]*v[5]^2*(0.00013 - 0.00019i) - v[3]*v[4]^2*(0.00012 + 0.00019i) + v[2]^2*v[5]*(0.00007 - 0.00022i) + v[3]^2*v[4]*(0.00006 + 0.00022i) + v[3]*v[5]^2*(0.00013 - 0.00019i) - v[2]*v[3]^2*(0.00001 - 0.00023i) + v[3]^2*v[5]*(0.00007 - 0.00022i) - v[4]*v[5]^2*(0.00007 - 0.00022i) - 0.00001*v[2]^2*v[7] + 0.00001*v[3]^2*v[6] - v[4]^2*v[5]*(0.00006 + 0.00022i) - 0.00001*v[3]^2*v[7] + 0.00001*v[4]^2*v[6] + 0.00001*v[5]^2*v[6] + v[2]^3*0.00008i - v[3]^3*0.00008i + v[4]^3*(0.00006 + 0.00005i) + v[5]^3*(0.00006 - 0.00005i) - v[2]*v[3]*v[4]*(0.00012 + 0.00044i) - v[2]*v[3]*v[5]*(0.00015 - 0.00044i) - 0.00001*v[2]*v[3]*v[6] + v[2]*v[4]*v[5]*(0.00001 - 0.00046i) + 0.00001*v[2]*v[3]*v[7] + 0.00001*v[2]*v[4]*v[6] - v[3]*v[4]*v[5]*(0.00001 - 0.00046i) - 0.00001*v[2]*v[4]*v[7] - 0.00001*v[2]*v[5]*v[6] - 0.00001*v[3]*v[4]*v[6] + 0.00001*v[2]*v[5]*v[7] + 0.00001*v[3]*v[4]*v[7] + 0.00001*v[3]*v[5]*v[6] - 0.00001*v[3]*v[5]*v[7] - 0.00001*v[4]*v[5]*v[6] + 0.00001*v[4]*v[5]*v[7]) + ka2*(- v[2]*v[3]*(0.0028 + 0.00008i) + v[2]*v[4]*(0.0027 - 0.00073i) - v[2]*v[5]*(0.00265 + 0.00088i) - v[3]*v[4]*(0.0027 - 0.00073i) - v[2]*v[6]*0.00008i + v[3]*v[5]*(0.00265 + 0.00088i) + v[2]*v[7]*0.00006i + v[3]*v[6]*0.00008i - v[4]*v[5]*(0.00279 + 0.00008i) - v[3]*v[7]*0.00006i - v[4]*v[6]*(0.00002 + 0.00008i) + v[4]*v[7]*(0.00002 + 0.00006i) - v[5]*v[6]*(0.00003 - 0.00008i) + v[5]*v[7]*(0.00002 - 0.00006i) + v[2]^2*(0.0014 + 0.00004i) + v[3]^2*(0.0014 + 0.00004i) + v[4]^2*(0.00119 - 0.00074i) + v[5]^2*(0.00114 + 0.0008i)) - 1.0*v[4]*(v[1]^3*(0.00004 + 0.00001i) + v[1]^2*(0.00103 + 0.00356i) + v[1]*(0.01494 + 0.15625i)) - 1.0*v[6]*(- v[1]^3*(0.00006 + 0.00004i) + v[1]^2*(0.0031 + 0.00272i) + v[1]*(0.14746 - 0.01382i)) - 1.0*v[5]*(v[1]^3*(0.00003 + 0.00003i) + v[1]^2*(0.00427 - 0.00114i) + v[1]*(0.17694 - 0.10919i)) + v[2]*(- v[1]^3*(0.00001 + 0.00003i) + v[1]^2*(0.00119 - 0.00348i) + v[1]*(0.06171 - 0.12039i))

    f[6]=v[7]*(- 0.0001*v[1]^3 + 0.09591*v[1]^2 + 1.99451*v[1]) + ka3*(v[2]^3*0.00001i - v[2]^2*v[3]*0.00003i + v[2]^2*v[4]*(0.00001 + 0.00003i) + v[2]^2*v[5]*(0.00001 - 0.00003i) + v[2]*v[3]^2*0.00003i - v[2]*v[3]*v[4]*(0.00002 + 0.00006i) - v[2]*v[3]*v[5]*(0.00002 - 0.00006i) + v[2]*v[4]^2*(0.00002 + 0.00003i) - v[2]*v[4]*v[5]*0.00006i - v[2]*v[5]^2*(0.00002 - 0.00003i) - v[3]^3*0.00001i + v[3]^2*v[4]*(0.00001 + 0.00003i) + v[3]^2*v[5]*(0.00001 - 0.00003i) - v[3]*v[4]^2*(0.00002 + 0.00003i) + v[3]*v[4]*v[5]*0.00006i + v[3]*v[5]^2*(0.00002 - 0.00003i) + v[4]^3*(0.00001 + 0.00001i) - v[4]^2*v[5]*(0.00001 + 0.00003i) - v[4]*v[5]^2*(0.00001 - 0.00003i) + v[5]^3*(0.00001 - 0.00001i)) - 1.0*v[4]*(- 0.00001*v[1]^3 + v[1]^2*(0.00772 - 0.00375i) + v[1]*(0.29677 - 0.00813i)) - 1.0*v[5]*(- 0.00001*v[1]^3 + v[1]^2*(0.00772 + 0.00375i) + v[1]*(0.29677 + 0.00813i)) - 1.0*ka2*(0.00019*v[2]^2 + v[2]*v[4]*(0.00036 - 0.00011i) - v[2]*v[5]*(0.00036 + 0.00011i) - v[3]*v[4]*(0.00036 - 0.00011i) - v[2]*v[6]*0.00001i + v[3]*v[5]*(0.00036 + 0.00011i) + v[2]*v[7]*0.00001i + v[3]*v[6]*0.00001i - 0.00037*v[4]*v[5] - v[3]*v[7]*0.00001i - v[4]*v[6]*0.00001i + v[4]*v[7]*0.00001i + v[5]*v[6]*0.00001i - v[5]*v[7]*0.00001i - 0.00037*v[2]*v[3] + 0.00019*v[3]^2 + v[4]^2*(0.00016 - 0.0001i) + v[5]^2*(0.00016 + 0.0001i)) - 1.0*v[6]*(0.00001*v[1]^3 - 0.01609*v[1]^2 + 1.96279*v[1]) - 47.1636*v[6] - 1.0*v[2]*(v[1]^2*(0.00471 + 0.0028i) + v[1]*(0.02438 - 0.01466i)) - 1.0*v[3]*(v[1]^2*(0.00471 - 0.0028i) + v[1]*(0.02438 + 0.01466i))

    f[7]=v[6]*(- 0.00247*v[1]^2 + 0.28828*v[1]) - 1.0*ka3*(v[2]^3*0.00001i - v[2]^2*v[3]*0.00004i + v[2]^2*v[4]*(0.00001 + 0.00004i) + v[2]^2*v[5]*(0.00001 - 0.00004i) + v[2]*v[3]^2*0.00004i - v[2]*v[3]*v[4]*(0.00002 + 0.00008i) - v[2]*v[3]*v[5]*(0.00002 - 0.00008i) + v[2]*v[4]^2*(0.00002 + 0.00003i) - v[2]*v[4]*v[5]*0.00008i - v[2]*v[5]^2*(0.00002 - 0.00003i) - v[3]^3*0.00001i + v[3]^2*v[4]*(0.00001 + 0.00004i) + v[3]^2*v[5]*(0.00001 - 0.00004i) - v[3]*v[4]^2*(0.00002 + 0.00003i) + v[3]*v[4]*v[5]*0.00008i + v[3]*v[5]^2*(0.00002 - 0.00003i) + v[4]^3*(0.00001 + 0.00001i) - v[4]^2*v[5]*(0.00001 + 0.00004i) - v[4]*v[5]^2*(0.00001 - 0.00004i) + v[5]^3*(0.00001 - 0.00001i)) + v[4]*(v[1]^2*(0.00109 - 0.00061i) + v[1]*(0.03749 - 0.0044i)) + v[5]*(v[1]^2*(0.00109 + 0.00061i) + v[1]*(0.03749 + 0.0044i)) - 1.0*v[7]*(- 0.00002*v[1]^3 + 0.01385*v[1]^2 + 0.2901*v[1]) - 1.0*v[2]*(- v[1]^2*(0.00068 + 0.00034i) + v[1]*(0.00058 + 0.00527i)) - 1.0*v[3]*(- v[1]^2*(0.00068 - 0.00034i) + v[1]*(0.00058 - 0.00527i)) + ka2*(0.00025*v[2]^2 + v[2]*v[4]*(0.00047 - 0.00014i) - v[2]*v[5]*(0.00047 + 0.00014i) - v[3]*v[4]*(0.00047 - 0.00014i) - v[2]*v[6]*0.00001i + v[3]*v[5]*(0.00047 + 0.00014i) + v[2]*v[7]*0.00001i + v[3]*v[6]*0.00001i - 0.00049*v[4]*v[5] - v[3]*v[7]*0.00001i - v[4]*v[6]*0.00001i + v[4]*v[7]*0.00001i + v[5]*v[6]*0.00001i - v[5]*v[7]*0.00001i - 0.00049*v[2]*v[3] + 0.00025*v[3]^2 + v[4]^2*(0.00021 - 0.00014i) + v[5]^2*(0.00021 + 0.00014i)) - 7.17102*v[7]

    f[2] = f[2]/ω_h; f[3] = f[3]/ω_h; f[4] = f[4]/ω_h; f[5] = f[5]/ω_h; f[6] = f[6]/ω_h; f[7] = f[7]/ω_h;

    return calculate_normal_form(f, v, norder, cm, m1, m2, m3, n, ω_h, zero_tol)
end



end # module
